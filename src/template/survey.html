<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>${survey.survey_name}_二哥网</title>
<meta name="keywords" content="二哥,二哥网,${survey.survey_name}" />
<meta name="description" content="${survey.survey_intro}" />
<link href="/home/images/favicon.ico" rel="shortcut icon">
<link rel="stylesheet" type="text/css" href="css/zhuanti1.css"/>
<link rel="stylesheet" type="text/css" href="css/answer.css"/>
<link rel="stylesheet" type="text/css" href="/home/css/header.css" />
<link rel="stylesheet" type="text/css" href="css/basis.css"/>
<base target="_blank">
</head>
<body>
    <div class="start">
    	 <div class="top1">
              <div class="ht">
                <div class="ht-inner" style="position: relative;">
                <!-- 微信显示开始 -->
					<div class="weih" id="weih" style="right: 30px; top: 43px;">
						<img src="/home/images/signal.jpg"/>
						<img src="/home/images/xsj.png" class="triang">
						<div class="follows">
							<label class="foll">关注二哥</label><br>
							<label>让购物消费<br>更专业更简单</label>
						</div>
					</div>
				<!-- 微信显示结束 -->
                    <ul class="ht-left">
                        <li><i class="iconfont">&#xe602;</i>客服热线：<span>400-600-3031</span>
                            <a href="http://www.2ge.cn/" target="_self" style="float:right"><input type="button"  class="fan" value="返回首页"></a>
                        </li>
                    </ul>
                    <ul class="ht-right" id="login_msg">
                        <li class="rightLi1" id="collect_msg"></li>
                    </ul>
                </div>
             </div>
     	</div>
        
        <!--中间内容开始-->
        <div class="middle">
        	 <div class="zhonei" style="margin-top:0px; width:1000px;">
             	<label class="anlabel">${survey.survey_name}</label>
                <p class="answer">
                	<!-- <textarea class="answertext" rows="" cols="" readonly="readonly">${survey.survey_intro}</textarea> -->
               		<label>${survey.survey_intro}</label>
                </p>
                <hr class="answerhr">
                <#list templelist as temple>
                <div class="answerdiv">
                	<input type="hidden" id="answ_id_${temple.quest_num}" value="${temple.quest_id}">
	         		<input type="hidden" id="answ_type_${temple.quest_num}" value="${temple.type}">
	         		<input type="hidden" id="answ_pre_${temple.quest_num}" value="${temple.is_pre}">
                	<p>${temple.quest_num}、${temple.title}<#if temple.type == '2'>【多选题】</#if>
                	<#if temple.is_pre == '0'><label style="color:#F00">*</label></#if>
                	<span id="answ_tips_${temple.quest_num}" style="color:#F00;display: none;">这道题必须回答哦</span>
                	</p>
                <#if temple.type == "3">
		         	<#if temple.is_single == "0">
		         	<table width="60%">
		         	<tr>
		         		<td><input type="text" id="answ_${temple.quest_num}" class="answerluru"></td>
		         	</tr>
		         	</table>
		         	<#else>
		         	<table width="60%">
		         	<tr>
		         		<td><textarea id="answ_${temple.quest_num}"></textarea></td>
		         	</tr>
		         	</table>
		         	</#if>
	         	<#elseif temple.type == "1">
	         		<ul>
		         	<#if temple.answlist ??>
		         	<#list temple.getAnswlist() as answ>
		         	<#if answ.is_val == "1">
	         		<li>
	         			<label class="xz">
	         			<input class="nt2" type="radio" id="answ_${temple.quest_num}" name="answ_${temple.quest_num}" value="${answ.answ_val}">
	         			<span></span>
						</label>
	         			<label class="zxbt" style="margin-left:10px">${answ.answ_val}</label>
	         		</li>
	         		<#else>
	         		<li>
	         			<label class="xz">
	         			<input class="nt2" type="radio" id="answ_${temple.quest_num}" name="answ_${temple.quest_num}" value="${answ.answ_val}|">
	         			<span></span>
	         			</label>
	         			<label class="zxbt" style="margin-left:10px">${answ.answ_val}</label>
	         			<input type="text" id="answ_text_${temple.quest_num}" class="answerluru">
	         		</li>
	         		</#if>
	         		</#list>
	         		</#if>
         			</ul>
         		<#elseif temple.type == "2">
         			<ul>
	         		<#if temple.answlist ??>
	         		<#list temple.getAnswlist() as answ>
		         	<#if answ.is_val == "1">
	         		<li>
	         			<label class="xz">
	         			<input class="nt2" type="checkbox" id="answ_${temple.quest_num}" name="answ_${temple.quest_num}" value="${answ.answ_val}">
	         			<span class="checfang"></span>
						</label>
	         			<label class="zxbt" style="margin-left:10px">${answ.answ_val}</label>
	         		</li>
	         		<#else>
	         		<li>
	         			<label class="xz">
	         			<input class="nt2" type="checkbox" id="answ_${temple.quest_num}" name="answ_${temple.quest_num}" value="${answ.answ_val}|">
	         			<span class="checfang"></span>
						</label>
	         			<label class="zxbt" style="margin-left:10px">${answ.answ_val}</label>
	         			<input type="text" id="answ_text_${temple.quest_num}" class="answerluru">
	         		</li>
	         		</#if>
	         		</#list>
	         		</#if>
         			</ul>
         		<#elseif temple.type == "4">
         			<table width="100%" style="margin-bottom: 10px;">
         				<tr >
         					<td style="padding:0px;"></td>
         					<#if temple.answlist ??>
			         		<#list temple.getAnswlist() as answ>
		         			<td style="padding:0px;">${answ.answ_val}</td>
			         		</#list>
			         		</#if>
         				</tr>
	         		<#if temple.addanswlist ??>
         				<input type="hidden" id="answ_num_${temple.quest_num}" value="${temple.getAddanswlist()?size}">
	         		<#list temple.getAddanswlist() as addansw>
	         			<tr>
	         				<input type="hidden" id="answ_add_${addansw_index}_${temple.quest_num}" value="${addansw.add_answ_val}">
	         				<td style="padding:0px;"><label style="font-size: 14px;">${addansw.add_answ_val}</label></td>
	         				<#if temple.answlist ??>
			         		<#list temple.getAnswlist() as answ>
		         			<td style="padding:0px;">
		         			<label class="xz">
		         			<input class="nt2" type="radio" id="answ_${addansw_index}_${temple.quest_num}" name="answ_${addansw_index}_${temple.quest_num}" value="${answ.answ_val}">
		         			<span></span>
							</label>
		         			</td>
			         		</#list>
			         		</#if>
	         			</tr>
	         		</#list>
	         		</#if>
		         	</table>
		        </#if>
                </div>
	         	</#list>
	         	<div class="answerdiv" style="padding-top:10px;" align="center">
                	<p>您的手机号<label style="color:#F00;">*</label>
                	<span id="mobile_tips" style="color:#F00;display: none;">手机号为空或格式有误</span>
                	</p>
		         	<table width="60%">
		         	<tr>
		         		<td><div align="center"><input type="text" id="mobile" class="answerluru" style="margin-right: -10px;" ></div></td>
		         	</tr>
	         		</table>
	         	</div>
                <div class="submits">
                	<input type="button" value="提交" onclick="saveSurv();">
                </div>
                <div class="foot foot1">
                <ul class="ul2">
                    <li><a target="_blank" href="/home/aboutus.html">关于我们</a></li>
                            <li class="margin35">|</li>
                            <li><a target="_blank" href="/home/contactus.html">联系我们</a></li>
                            <li class="margin35">|</li>
                            <li><a target="_blank" href="/home/copyright.html">版权所有</a></li>
                            <li class="margin35">|</li>
                            <li><a target="_blank" href="/home/policy.html">隐私政策</a></li>
                            <li class="margin35">|</li>
                            <li><a target="_blank" href="/home/legaldec.html">法律声明</a></li>
                            <li class="margin35">|</li>
                            <li><a target="_blank" href="/home/intelpro.html">知识产权</a></li>                         
                </ul>
                <div >
                    <p >客服热线电话：<span>400-600-3031</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;问题建议邮箱：jy@zhixingshidai.com</p>
                    <p>Copyright 2014 &copy;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;智行时代国际传媒（北京）有限公司&nbsp;&nbsp;&nbsp;版权所有京 ICP备14039455号-2</p>
                </div>
      		</div>
           </div>
       	</div>
        </div>
        <!--中间内容结束-->
     <script src="js/jquery-1.11.1.min.js" type="text/javascript"></script>
     <script src="js/json2.js" type="text/javascript"></script>
	 <script src="/home/js/msg.js" type="text/javascript"></script>
	 <script type="text/javascript" src="/home/js/prompt.js"></script>
	 <script type="text/javascript">
	 	$(function(){
	 		//单选 重置
		 	$("input[type=radio]").each(function(){
		   		$(this).removeAttr("checked");
		 	})
		 	//多选 重置
		 	$("input[type=checkbox]").each(function(){
		   		$(this).removeAttr("checked");
		 	})
		 	//输入框 重置
		 	$("input[type=text]").each(function(){
		   		$(this).val("");
		 	})
		 	//文本域 重置
		 	$("textarea").each(function(e){
		 		if(e != 0){
			   		$(this).val("");
		 		}
		 	})
	 	})
	 	
	 	//百度统计
	 	var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?0f2a592e85c9d1d8167f5baad229d4b5";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
		//百度推送
		(function(){
		    var bp = document.createElement("script");
		    var curProtocol = window.location.protocol.split(':')[0];
		    if (curProtocol === 'https') {
		        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
		    }
		    else {
		        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		    }
		    var push_s = document.getElementsByTagName("script")[0];
		    push_s.parentNode.insertBefore(bp, push_s);
		})();
		
		
		function isMObile(s) 
		{ 
			var patrn=/^1[3|4|5|7|8][0-9]\d{8}$/; 
			if (!patrn.test(s)) 
			{
				return false; 
			}else{
				return true ;
			}
		}
		//总题数
		var quest_count = ${survey.quest_count};
		//问卷ID
		var survey_id = '${survey.survey_id}';
		function saveSurv(){
			var isSubmit = true;
			var answArray = new Array();
			$("#mobile_tips").css("display","none");
			var mobile = $("#mobile").val();
			if(mobile == "" || !isMObile(mobile))
			{
				isSubmit = false;
				$("#mobile_tips").css("display","block");
			}
			for(var i=1;i<=quest_count;i++){
				$("#answ_tips_"+i).css("display","none");
				var quest_id = $("#answ_id_"+i).val();
				var quest_type = $("#answ_type_"+i).val();
				var quest_pre = $("#answ_pre_"+i).val();
				if(quest_type == "3"){//填空题
					var answ = $("#answ_"+i).val();
					//答案为空
					if(!answ || answ == ""){
						//是否必填
						if(quest_pre == "0"){
							isSubmit = false;
							$("#answ_tips_"+i).css("display","block");
						}
					}else{
						if(answ.length > 200)
						{
							isSubmit = false;
							tsk("超出最大限制字数");
						}else{
							var answData = {"quest_id":quest_id,"answ_val":answ,"add_answ_val":""};
							answArray.push(answData);
						}
					}
				}else if(quest_type == "1"){//单选题
					var answ = $("input[name='answ_"+i+"']:checked").val();
					//根据|判断是否 自定义选项
					if(!(!answ) && answ.indexOf("|") >= 0)
					{
						var other_val = $("#answ_text_"+i).val();
						if(other_val == ""){
							answ = answ.substring(0,answ.length-1);
						}else{
							answ = answ+other_val;
						}
					}
					//答案为空
					if(!answ || answ == ""){
						//是否必填
						if(quest_pre == "0"){
							isSubmit = false;
							$("#answ_tips_"+i).css("display","block");
						}
					}else{
						if(answ.length > 200)
						{
							isSubmit = false;
							tsk("超出最大限制字数");
						}else{
							var answData = {"quest_id":quest_id,"answ_val":answ,"add_answ_val":""};
							answArray.push(answData);
						}
					}
				}else if(quest_type == "2"){//多选题
					var answ_each = "";
					$("input[name='answ_"+i+"']:checked").each(function(){
						var answ = $(this).val();
						//根据|判断是否 自定义选项
						if(!(!answ) && answ.indexOf("|") >= 0)
						{
							var other_val = $("#answ_text_"+i).val();
							if(other_val == ""){
								answ = answ.substring(0,answ.length-1);
							}else{
								answ = answ+other_val;
							}
						}
						answ_each += answ;
						if(answ.length > 200)
						{
							isSubmit = false;
							tsk("超出最大限制字数");
						}else{
							var answData = {"quest_id":quest_id,"answ_val":answ,"add_answ_val":""};
							answArray.push(answData);
						}
					});
					//是否必填
					if(quest_pre == "0")
					{
						if(answ_each == ""){
							isSubmit = false;
							$("#answ_tips_"+i).css("display","block");
						}
					}
				}else if(quest_type == "4"){//矩阵单选题
					var add_num = $("#answ_num_"+i).val();
					for(var j=0;j<add_num;j++){
						var add_val = $("#answ_add_"+j+"_"+i).val();
						var answ = $("input[name='answ_"+j+"_"+i+"']:checked").val();
						//答案为空
						if(!answ || answ == ""){
							//是否必填
							if(quest_pre == "0"){
								isSubmit = false;
								$("#answ_tips_"+i).css("display","block");
							}
						}else{
							var answData = {"quest_id":quest_id,"answ_val":answ,"add_answ_val":add_val};
							answArray.push(answData);
						}
					}
				}
			}
			if(isSubmit)
			{
				post("/home/survey.html",{mobile:mobile,survey_id:survey_id,answs:JSON.stringify(answArray)});
				/* $.ajax({
					url:"/home/survey.html",
					method:"post",
					dataType:"text",
					data:{"mobile":mobile,"survey_id":survey_id,"answs":JSON.stringify(answArray)},
					success:function(res){
						if(res == "true")
						{
							tsk("提交成功");
							//单选 重置
						 	$("input[type=radio]").each(function(){
						   		$(this).removeAttr("checked");
						 	})
						 	//多选 重置
						 	$("input[type=checkbox]").each(function(){
						   		$(this).removeAttr("checked");
						 	})
						 	//输入框 重置
						 	$("input[type=text]").each(function(){
						   		$(this).val("");
						 	})
						 	//文本域 重置
						 	$("textarea").each(function(){
						   		$(this).val("");
						 	})
						}else{
							tsk("提交失败");
						}
					}
				}) */
			}
		}
		
		function post(URL, PARAMS) { 
			var temp = document.createElement("form"); 
			temp.action = URL; 
			temp.method = "post"; 
			temp.style.display = "none"; 
			for (var x in PARAMS) { 
			var opt = document.createElement("textarea"); 
			opt.name = x; 
			opt.value = PARAMS[x]; 
			temp.appendChild(opt); 
			} 
			document.body.appendChild(temp); 
			temp.submit(); 
		} 
	 </script>
</body>
</html>
